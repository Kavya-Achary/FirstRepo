import {
    SecretsManagerClient,
    GetSecretValueCommand,
} from "@aws-sdk/client-secrets-manager";
import mysql from "mysql";

export const handler = async (event) => {
    const secret_name = "database/custom-apps/costengine";

    const client = new SecretsManagerClient({
        region: context.invokedFunctionArn.split(":")[3],
    });

    let resp;

    try {
        resp = await client.send(
            new GetSecretValueCommand({
                SecretId: secret_name,
                VersionStage: "AWSCURRENT", // VersionStage defaults to AWSCURRENT if unspecified..
            })
        );
    } catch (error) {
        // For a list of exceptions thrown, see
        // https://docs.aws.amazon.com/secretsmanager/latest/apireference/API_GetSecretValue.html
        throw error;
    }

    const secrets = await JSON.parse(resp.SecretString);


    const poolObj = {
        host: secrets.host,
        user: secrets.username,
        password: secrets.password,
        port: secrets.port,
        database: secrets.dbname,
    };

    const pool = mysql.createPool(poolObj);
    const equipArray = ["D20", "D40", "D45", "R20", "R40"];

    const runQuery = async (pool, q) => {
        return await new Promise((resolve, reject) => {
            pool.query(q, (error, results) => {
                if (error) {
                    reject(error);
                } else {
                    resolve(results);
                }
            });
        });
    };

    let returnPercID = 'P51005';
    let returnPercArr = [0.67,0.71,0.73,0.7,0.74,0.72,0.73,0.72,0.72,0.73,0.69,0.68];


    // 1. Parse csv json data, and find the breakdown (cost item) id that matches for the cost center id
    //    and breakdown id.
    // 2. If the _Worktag_Value_ID = 0, we need to duplicate the cost by month across all equipment types
    //    having a 0 value means "same price across all equipment types.  value not repeated or shown
    //    for each type of equipment".
    // 3. Check the tonnage array to see if the current breakdown id is listed.  if so, we need to multipy
    //    the cost value by weight, and assign to each equipment cost.
    //    20 foot equipment is cost shown. 40 foot equipment is double.  45 foot is 2.25 cost.
    // 4. Loop through "doubles" array to find breakdown ids that will require their cost to be doubled for
    //    on/off costs.
    // 5. Certain equipment types need cost set to 0, as some cost items only exist on specific equipment
    //    types.  This allows us to show cost items for both Dry and Refer, where some cost points do
    //    not exist.
    // 6. Append the new insert block into the final output query to be returned.

    const dateArr = [
        "_Jan",
        "_Feb",
        "_Mar",
        "_Apr",
        "_May",
        "_Jun",
        "_Jul",
        "_Aug",
        "_Sep",
        "_Oct",
        "_Nov",
        "_Dec",
    ];

    const dryEquip = [1,2,3];
    const referEquip = [4,5];

    const doubleCalcArr = [
        {id: 4, costCenters: [10, 11]},
        {id: 5, costCenters: [10, 11]},
    ];

    const percentCalcArr = [
        {id: 1, costCenters: [10, 11]},
        {id: 2, costCenters: [10, 11]},
        {id: 30, costCenters: [10, 11]},
        {id: 31, costCenters: [10, 11]},
        {id: 32, costCenters: [10, 11]},
        {id: 33, costCenters: [10, 11]}];

    const referEquipZeroArr = [9,17];
    const dryEquipZeroArr = [10,11,12,16];

    const tonnageArray = [3,34,35]; // ids of tonnage cost items

    const getDate = (m, y) => {
        let mon = dateArr.indexOf(m) + 1;
        if (mon < 10) mon = `0${mon}`;
        return `${y}/${mon}/15 0:00`;
    };

    let returnQuery = "INSERT INTO `Costs` (`EquipmentID`,`BreakdownID`,`CostCenterID`,`Date`,`Cost`) VALUES ";

    const buildQueryByMonth = async ({ EquipmentID, BreakdownID, item }) => {
        const containerType =  dryEquip.includes(EquipmentID) ? "dry" : "refer";

        dateArr.map((d, i) => {
            const Date = getDate(d, item._Year);
            let cost = item[d];

            // some items are only valid based on container type ( dry or refer )
            //P51820, P51822 = 20, 21

            const costCenterNum = Number(`${String(item._Cost_Center)[0]}${String(item._Cost_Center)[1]}`);

            if(tonnageArray.includes(Number(BreakdownID))) {
                cost = (Number(equipArray[EquipmentID-1].substring(1))/20) * cost;
            }

            if (doubleCalcArr.some(e => e.id === BreakdownID && e.costCenters.includes(costCenterNum))) {
                // double some cost values for on/off port charge
                cost = item[d] * 2;
            }

            if (percentCalcArr.some(e => e.id === BreakdownID && e.costCenters.includes(costCenterNum))) {
                // multiply these values by a percentage for off port charge
                cost = item[d] * (1 + returnPercArr[i]);
            }




            if((dryEquipZeroArr.includes(BreakdownID) && containerType === 'dry' ) || (referEquipZeroArr.includes(BreakdownID) && containerType === 'refer')) {
                cost = 0;
            }

            const CostCenterID = item._Cost_Center

            returnQuery +=
                "('" +
                EquipmentID +
                "', '" +
                BreakdownID +
                "', '" +
                CostCenterID +
                "', '" +
                Date +
                "', '" +
                cost +
                "'),";


        });
        //console.log(returnQuery);
        //query.substring(0, returnQuery.length - 1);
        //console.log(query);
    };

    const breakdownItems = await runQuery(pool, "select * FROM `BreakdownItems`");

    let res =
        [
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51010",
                "_Cost_Center": 10500103,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 566.69,
                "_Feb": 566.69,
                "_Mar": 566.69,
                "_Apr": 566.69,
                "_May": 566.69,
                "_Jun": 566.69,
                "_Jul": 578.02,
                "_Aug": 578.02,
                "_Sep": 578.02,
                "_Oct": 578.02,
                "_Nov": 578.02,
                "_Dec": 578.02
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51020",
                "_Cost_Center": 10500103,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 23.58,
                "_Feb": 24.15,
                "_Mar": 22.66,
                "_Apr": 23.44,
                "_May": 22.8,
                "_Jun": 22.28,
                "_Jul": 23.25,
                "_Aug": 23.44,
                "_Sep": 24.2,
                "_Oct": 20.08,
                "_Nov": 21.41,
                "_Dec": 23.85
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P54000",
                "_Cost_Center": 10500103,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 41.16,
                "_Feb": 41.16,
                "_Mar": 41.16,
                "_Apr": 41.16,
                "_May": 41.16,
                "_Jun": 41.16,
                "_Jul": 42.4,
                "_Aug": 42.4,
                "_Sep": 42.4,
                "_Oct": 42.4,
                "_Nov": 42.4,
                "_Dec": 42.4
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51010",
                "_Cost_Center": 10500128,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 460.37,
                "_Feb": 460.37,
                "_Mar": 460.37,
                "_Apr": 460.37,
                "_May": 460.37,
                "_Jun": 460.37,
                "_Jul": 469.58,
                "_Aug": 469.58,
                "_Sep": 469.58,
                "_Oct": 469.58,
                "_Nov": 469.58,
                "_Dec": 469.58
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51020",
                "_Cost_Center": 10500128,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 9.32,
                "_Feb": 9.21,
                "_Mar": 10.55,
                "_Apr": 9.45,
                "_May": 9.18,
                "_Jun": 9.2,
                "_Jul": 9.12,
                "_Aug": 8.93,
                "_Sep": 9.61,
                "_Oct": 9.51,
                "_Nov": 9.6,
                "_Dec": 10.66
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51010",
                "_Cost_Center": 10500129,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 400.14,
                "_Feb": 400.14,
                "_Mar": 400.14,
                "_Apr": 400.14,
                "_May": 400.14,
                "_Jun": 400.14,
                "_Jul": 408.14,
                "_Aug": 408.14,
                "_Sep": 408.14,
                "_Oct": 408.14,
                "_Nov": 408.14,
                "_Dec": 408.14
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P54000",
                "_Cost_Center": 10500130,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 41.43,
                "_Feb": 41.43,
                "_Mar": 41.43,
                "_Apr": 41.43,
                "_May": 41.43,
                "_Jun": 41.43,
                "_Jul": 42.68,
                "_Aug": 42.68,
                "_Sep": 42.68,
                "_Oct": 42.68,
                "_Nov": 42.68,
                "_Dec": 42.68
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51010",
                "_Cost_Center": 10500142,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 405.88,
                "_Feb": 405.88,
                "_Mar": 405.88,
                "_Apr": 405.88,
                "_May": 405.88,
                "_Jun": 405.88,
                "_Jul": 418.06,
                "_Aug": 418.06,
                "_Sep": 418.06,
                "_Oct": 418.06,
                "_Nov": 418.06,
                "_Dec": 418.06
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51020",
                "_Cost_Center": 10500142,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 126.01,
                "_Feb": 66.03,
                "_Mar": 80.55,
                "_Apr": 78.79,
                "_May": 77.63,
                "_Jun": 80.2,
                "_Jul": 79.65,
                "_Aug": 77.44,
                "_Sep": 79.96,
                "_Oct": 73,
                "_Nov": 72.11,
                "_Dec": 80.04
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P54000",
                "_Cost_Center": 10500142,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 41.15,
                "_Feb": 41.15,
                "_Mar": 41.15,
                "_Apr": 41.15,
                "_May": 41.15,
                "_Jun": 41.15,
                "_Jul": 42.39,
                "_Aug": 42.39,
                "_Sep": 42.39,
                "_Oct": 42.39,
                "_Nov": 42.39,
                "_Dec": 42.39
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P69000",
                "_Cost_Center": 11650199,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": -70.5,
                "_Feb": -65.05,
                "_Mar": -66.9,
                "_Apr": -68.21,
                "_May": -67.63,
                "_Jun": -70.33,
                "_Jul": -71.21,
                "_Aug": -71.23,
                "_Sep": -78.9,
                "_Oct": -68.58,
                "_Nov": -64.63,
                "_Dec": -68.08
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51000",
                "_Cost_Center": 10500300,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 223.81,
                "_Feb": 223.81,
                "_Mar": 223.81,
                "_Apr": 223.81,
                "_May": 223.81,
                "_Jun": 223.81,
                "_Jul": 227.61,
                "_Aug": 227.61,
                "_Sep": 227.61,
                "_Oct": 227.61,
                "_Nov": 227.61,
                "_Dec": 227.61
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51005",
                "_Cost_Center": 10500300,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 0.67,
                "_Feb": 0.71,
                "_Mar": 0.73,
                "_Apr": 0.7,
                "_May": 0.74,
                "_Jun": 0.72,
                "_Jul": 0.73,
                "_Aug": 0.72,
                "_Sep": 0.72,
                "_Oct": 0.73,
                "_Nov": 0.69,
                "_Dec": 0.68
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51031",
                "_Cost_Center": 10500300,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 25.65,
                "_Feb": 25.65,
                "_Mar": 25.65,
                "_Apr": 25.65,
                "_May": 25.65,
                "_Jun": 25.65,
                "_Jul": 26.42,
                "_Aug": 26.42,
                "_Sep": 26.42,
                "_Oct": 26.42,
                "_Nov": 26.42,
                "_Dec": 26.42
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51040",
                "_Cost_Center": 10500300,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 64.09,
                "_Feb": 59.45,
                "_Mar": 58.69,
                "_Apr": 58.48,
                "_May": 58.78,
                "_Jun": 57.82,
                "_Jul": 58.08,
                "_Aug": 57.54,
                "_Sep": 59.92,
                "_Oct": 57.14,
                "_Nov": 56.73,
                "_Dec": 63.01
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51500",
                "_Cost_Center": 10500300,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 713.57,
                "_Feb": 668.28,
                "_Mar": 628.46,
                "_Apr": 662.73,
                "_May": 651.61,
                "_Jun": 614.7,
                "_Jul": 650.97,
                "_Aug": 644.75,
                "_Sep": 638.57,
                "_Oct": 657.2,
                "_Nov": 643.57,
                "_Dec": 686.27
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51030",
                "_Cost_Center": 10500300,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "D20",
                "_Labor_Group": "00000000000",
                "_Jan": 178.38,
                "_Feb": 178.38,
                "_Mar": 178.38,
                "_Apr": 178.38,
                "_May": 178.38,
                "_Jun": 178.38,
                "_Jul": 183.73,
                "_Aug": 183.73,
                "_Sep": 183.73,
                "_Oct": 183.73,
                "_Nov": 183.73,
                "_Dec": 183.73
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51030",
                "_Cost_Center": 10500300,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "D40",
                "_Labor_Group": "00000000000",
                "_Jan": 356.77,
                "_Feb": 356.77,
                "_Mar": 356.77,
                "_Apr": 356.77,
                "_May": 356.77,
                "_Jun": 356.77,
                "_Jul": 367.47,
                "_Aug": 367.47,
                "_Sep": 367.47,
                "_Oct": 367.47,
                "_Nov": 367.47,
                "_Dec": 367.47
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51030",
                "_Cost_Center": 10500300,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "D45",
                "_Labor_Group": "00000000000",
                "_Jan": 356.77,
                "_Feb": 356.77,
                "_Mar": 356.77,
                "_Apr": 356.77,
                "_May": 356.77,
                "_Jun": 356.77,
                "_Jul": 367.47,
                "_Aug": 367.47,
                "_Sep": 367.47,
                "_Oct": 367.47,
                "_Nov": 367.47,
                "_Dec": 367.47
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51030",
                "_Cost_Center": 10500300,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "R20",
                "_Labor_Group": "00000000000",
                "_Jan": 178.38,
                "_Feb": 178.38,
                "_Mar": 178.38,
                "_Apr": 178.38,
                "_May": 178.38,
                "_Jun": 178.38,
                "_Jul": 183.73,
                "_Aug": 183.73,
                "_Sep": 183.73,
                "_Oct": 183.73,
                "_Nov": 183.73,
                "_Dec": 183.73
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51030",
                "_Cost_Center": 10500300,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "R40",
                "_Labor_Group": "00000000000",
                "_Jan": 356.77,
                "_Feb": 356.77,
                "_Mar": 356.77,
                "_Apr": 356.77,
                "_May": 356.77,
                "_Jun": 356.77,
                "_Jul": 367.47,
                "_Aug": 367.47,
                "_Sep": 367.47,
                "_Oct": 367.47,
                "_Nov": 367.47,
                "_Dec": 367.47
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51031",
                "_Cost_Center": 11500300,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 12.84,
                "_Feb": 12.84,
                "_Mar": 12.84,
                "_Apr": 12.84,
                "_May": 12.84,
                "_Jun": 12.84,
                "_Jul": 13.22,
                "_Aug": 13.22,
                "_Sep": 13.22,
                "_Oct": 13.22,
                "_Nov": 13.22,
                "_Dec": 13.22
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51550",
                "_Cost_Center": 11500300,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 2081.35,
                "_Feb": 1987.34,
                "_Mar": 2050.19,
                "_Apr": 2054.18,
                "_May": 2050.69,
                "_Jun": 2052.81,
                "_Jul": 2078.79,
                "_Aug": 2116.3,
                "_Sep": 2184.87,
                "_Oct": 2052.09,
                "_Nov": 1974.17,
                "_Dec": 2066.33
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51030",
                "_Cost_Center": 11500300,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "D20",
                "_Labor_Group": "00000000000",
                "_Jan": 198.24,
                "_Feb": 198.24,
                "_Mar": 198.24,
                "_Apr": 198.24,
                "_May": 198.24,
                "_Jun": 198.24,
                "_Jul": 204.18,
                "_Aug": 204.18,
                "_Sep": 204.18,
                "_Oct": 204.18,
                "_Nov": 204.18,
                "_Dec": 204.18
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51030",
                "_Cost_Center": 11500300,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "D40",
                "_Labor_Group": "00000000000",
                "_Jan": 396.38,
                "_Feb": 396.38,
                "_Mar": 396.38,
                "_Apr": 396.38,
                "_May": 396.38,
                "_Jun": 396.38,
                "_Jul": 408.28,
                "_Aug": 408.28,
                "_Sep": 408.28,
                "_Oct": 408.28,
                "_Nov": 408.28,
                "_Dec": 408.28
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51030",
                "_Cost_Center": 11500300,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "D45",
                "_Labor_Group": "00000000000",
                "_Jan": 396.38,
                "_Feb": 396.38,
                "_Mar": 396.38,
                "_Apr": 396.38,
                "_May": 396.38,
                "_Jun": 396.38,
                "_Jul": 408.28,
                "_Aug": 408.28,
                "_Sep": 408.28,
                "_Oct": 408.28,
                "_Nov": 408.28,
                "_Dec": 408.28
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51030",
                "_Cost_Center": 11500300,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "R20",
                "_Labor_Group": "00000000000",
                "_Jan": 198.24,
                "_Feb": 198.24,
                "_Mar": 198.24,
                "_Apr": 198.24,
                "_May": 198.24,
                "_Jun": 198.24,
                "_Jul": 204.18,
                "_Aug": 204.18,
                "_Sep": 204.18,
                "_Oct": 204.18,
                "_Nov": 204.18,
                "_Dec": 204.18
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51030",
                "_Cost_Center": 11500300,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "R40",
                "_Labor_Group": "00000000000",
                "_Jan": 396.38,
                "_Feb": 396.38,
                "_Mar": 396.38,
                "_Apr": 396.38,
                "_May": 396.38,
                "_Jun": 396.38,
                "_Jul": 408.28,
                "_Aug": 408.28,
                "_Sep": 408.28,
                "_Oct": 408.28,
                "_Nov": 408.28,
                "_Dec": 408.28
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51820",
                "_Cost_Center": 10500900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 5.18,
                "_Feb": 5.18,
                "_Mar": 5.18,
                "_Apr": 5.18,
                "_May": 5.18,
                "_Jun": 5.18,
                "_Jul": 5.18,
                "_Aug": 5.18,
                "_Sep": 5.18,
                "_Oct": 5.18,
                "_Nov": 5.18,
                "_Dec": 5.18
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P51822",
                "_Cost_Center": 10500900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 38.1,
                "_Feb": 38.1,
                "_Mar": 38.1,
                "_Apr": 38.1,
                "_May": 38.1,
                "_Jun": 38.1,
                "_Jul": 38.1,
                "_Aug": 38.1,
                "_Sep": 38.1,
                "_Oct": 38.1,
                "_Nov": 38.1,
                "_Dec": 38.1
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P61000",
                "_Cost_Center": 10600900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 804.09,
                "_Feb": 745.36,
                "_Mar": 722.5,
                "_Apr": 742.85,
                "_May": 728.16,
                "_Jun": 685.74,
                "_Jul": 793.58,
                "_Aug": 734.74,
                "_Sep": 768.97,
                "_Oct": 744.38,
                "_Nov": 724.93,
                "_Dec": 787.28
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P69000",
                "_Cost_Center": 10650900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": -141.66,
                "_Feb": -133.11,
                "_Mar": -131.38,
                "_Apr": -132.91,
                "_May": -131.29,
                "_Jun": -133.9,
                "_Jul": -134.25,
                "_Aug": -133.92,
                "_Sep": -146.23,
                "_Oct": -133.72,
                "_Nov": -129.01,
                "_Dec": -139.41
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P67000",
                "_Cost_Center": 10700900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 623.4,
                "_Feb": 519.63,
                "_Mar": 501.03,
                "_Apr": 535.47,
                "_May": 527.08,
                "_Jun": 493.52,
                "_Jul": 521.08,
                "_Aug": 500.21,
                "_Sep": 508.6,
                "_Oct": 542.44,
                "_Nov": 522.45,
                "_Dec": 515.4
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P71000",
                "_Cost_Center": 10700900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 551.75,
                "_Feb": 552.84,
                "_Mar": 545.74,
                "_Apr": 572.84,
                "_May": 549.71,
                "_Jun": 526.46,
                "_Jul": 559.6,
                "_Aug": 543.75,
                "_Sep": 530.44,
                "_Oct": 539.49,
                "_Nov": 539.92,
                "_Dec": 547.45
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P73105",
                "_Cost_Center": 10700900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 776.88,
                "_Feb": 776.88,
                "_Mar": 776.88,
                "_Apr": 776.88,
                "_May": 776.88,
                "_Jun": 776.88,
                "_Jul": 776.88,
                "_Aug": 776.88,
                "_Sep": 776.88,
                "_Oct": 776.88,
                "_Nov": 776.88,
                "_Dec": 776.88
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P73110",
                "_Cost_Center": 10700900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 254.93,
                "_Feb": 254.93,
                "_Mar": 254.93,
                "_Apr": 254.93,
                "_May": 254.93,
                "_Jun": 254.93,
                "_Jul": 254.93,
                "_Aug": 254.93,
                "_Sep": 254.93,
                "_Oct": 254.93,
                "_Nov": 254.93,
                "_Dec": 254.93
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P73115",
                "_Cost_Center": 10700900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 152.21,
                "_Feb": 152.21,
                "_Mar": 152.21,
                "_Apr": 152.21,
                "_May": 152.21,
                "_Jun": 152.21,
                "_Jul": 152.21,
                "_Aug": 152.21,
                "_Sep": 152.21,
                "_Oct": 152.21,
                "_Nov": 152.21,
                "_Dec": 152.21
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P73120",
                "_Cost_Center": 10700900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 22.19,
                "_Feb": 22.19,
                "_Mar": 22.19,
                "_Apr": 22.19,
                "_May": 22.19,
                "_Jun": 22.19,
                "_Jul": 22.19,
                "_Aug": 22.19,
                "_Sep": 22.19,
                "_Oct": 22.19,
                "_Nov": 22.19,
                "_Dec": 22.19
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P73900",
                "_Cost_Center": 10700900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 187.95,
                "_Feb": 187.95,
                "_Mar": 187.95,
                "_Apr": 187.95,
                "_May": 187.95,
                "_Jun": 187.95,
                "_Jul": 187.95,
                "_Aug": 187.95,
                "_Sep": 187.95,
                "_Oct": 187.95,
                "_Nov": 187.95,
                "_Dec": 187.95
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P80000",
                "_Cost_Center": 10800900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 286.75,
                "_Feb": 273.5,
                "_Mar": 261.85,
                "_Apr": 273.67,
                "_May": 267.07,
                "_Jun": 263.24,
                "_Jul": 261.8,
                "_Aug": 262.56,
                "_Sep": 269.21,
                "_Oct": 271.3,
                "_Nov": 260.43,
                "_Dec": 301.22
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P90920",
                "_Cost_Center": 10900900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 239.46,
                "_Feb": 239.46,
                "_Mar": 239.46,
                "_Apr": 239.46,
                "_May": 239.46,
                "_Jun": 239.46,
                "_Jul": 239.46,
                "_Aug": 239.46,
                "_Sep": 239.46,
                "_Oct": 239.46,
                "_Nov": 239.46,
                "_Dec": 239.46
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P90990",
                "_Cost_Center": 10900900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 108.78,
                "_Feb": 108.78,
                "_Mar": 108.78,
                "_Apr": 108.78,
                "_May": 108.78,
                "_Jun": 108.78,
                "_Jul": 108.78,
                "_Aug": 108.78,
                "_Sep": 108.78,
                "_Oct": 108.78,
                "_Nov": 108.78,
                "_Dec": 108.78
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P90905",
                "_Cost_Center": 10900900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "D20",
                "_Labor_Group": "00000000000",
                "_Jan": 63.73,
                "_Feb": 63.73,
                "_Mar": 63.73,
                "_Apr": 63.73,
                "_May": 63.73,
                "_Jun": 63.73,
                "_Jul": 63.73,
                "_Aug": 63.73,
                "_Sep": 63.73,
                "_Oct": 63.73,
                "_Nov": 63.73,
                "_Dec": 63.73
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P90905",
                "_Cost_Center": 10900900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "D40",
                "_Labor_Group": "00000000000",
                "_Jan": 52.95,
                "_Feb": 52.95,
                "_Mar": 52.95,
                "_Apr": 52.95,
                "_May": 52.95,
                "_Jun": 52.95,
                "_Jul": 52.95,
                "_Aug": 52.95,
                "_Sep": 52.95,
                "_Oct": 52.95,
                "_Nov": 52.95,
                "_Dec": 52.95
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P90905",
                "_Cost_Center": 10900900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "D45",
                "_Labor_Group": "00000000000",
                "_Jan": 56.87,
                "_Feb": 56.87,
                "_Mar": 56.87,
                "_Apr": 56.87,
                "_May": 56.87,
                "_Jun": 56.87,
                "_Jul": 56.87,
                "_Aug": 56.87,
                "_Sep": 56.87,
                "_Oct": 56.87,
                "_Nov": 56.87,
                "_Dec": 56.87
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P90905",
                "_Cost_Center": 10900900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "R20",
                "_Labor_Group": "00000000000",
                "_Jan": 150.67,
                "_Feb": 150.67,
                "_Mar": 150.67,
                "_Apr": 150.67,
                "_May": 150.67,
                "_Jun": 150.67,
                "_Jul": 150.67,
                "_Aug": 150.67,
                "_Sep": 150.67,
                "_Oct": 150.67,
                "_Nov": 150.67,
                "_Dec": 150.67
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P90905",
                "_Cost_Center": 10900900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "R40",
                "_Labor_Group": "00000000000",
                "_Jan": 138.77,
                "_Feb": 138.77,
                "_Mar": 138.77,
                "_Apr": 138.77,
                "_May": 138.77,
                "_Jun": 138.77,
                "_Jul": 138.77,
                "_Aug": 138.77,
                "_Sep": 138.77,
                "_Oct": 138.77,
                "_Nov": 138.77,
                "_Dec": 138.77
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P90915",
                "_Cost_Center": 11900900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "",
                "_Worktag_Value_ID": "00000000000",
                "_Labor_Group": "00000000000",
                "_Jan": 24.5,
                "_Feb": 24.5,
                "_Mar": 24.5,
                "_Apr": 24.5,
                "_May": 24.5,
                "_Jun": 24.5,
                "_Jul": 24.5,
                "_Aug": 24.5,
                "_Sep": 24.5,
                "_Oct": 24.5,
                "_Nov": 24.5,
                "_Dec": 24.5
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P90910",
                "_Cost_Center": 11900900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "D20",
                "_Labor_Group": "00000000000",
                "_Jan": 23.53,
                "_Feb": 23.53,
                "_Mar": 23.53,
                "_Apr": 23.53,
                "_May": 23.53,
                "_Jun": 23.53,
                "_Jul": 23.53,
                "_Aug": 23.53,
                "_Sep": 23.53,
                "_Oct": 23.53,
                "_Nov": 23.53,
                "_Dec": 23.53
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P90910",
                "_Cost_Center": 11900900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "D40",
                "_Labor_Group": "00000000000",
                "_Jan": 12.75,
                "_Feb": 12.75,
                "_Mar": 12.75,
                "_Apr": 12.75,
                "_May": 12.75,
                "_Jun": 12.75,
                "_Jul": 12.75,
                "_Aug": 12.75,
                "_Sep": 12.75,
                "_Oct": 12.75,
                "_Nov": 12.75,
                "_Dec": 12.75
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P90910",
                "_Cost_Center": 11900900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "D45",
                "_Labor_Group": "00000000000",
                "_Jan": 7.84,
                "_Feb": 7.84,
                "_Mar": 7.84,
                "_Apr": 7.84,
                "_May": 7.84,
                "_Jun": 7.84,
                "_Jul": 7.84,
                "_Aug": 7.84,
                "_Sep": 7.84,
                "_Oct": 7.84,
                "_Nov": 7.84,
                "_Dec": 7.84
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P90910",
                "_Cost_Center": 11900900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "R20",
                "_Labor_Group": "00000000000",
                "_Jan": 35.68,
                "_Feb": 35.68,
                "_Mar": 35.68,
                "_Apr": 35.68,
                "_May": 35.68,
                "_Jun": 35.68,
                "_Jul": 35.68,
                "_Aug": 35.68,
                "_Sep": 35.68,
                "_Oct": 35.68,
                "_Nov": 35.68,
                "_Dec": 35.68
            },
            {
                "_Plan_Name": "Matson Plan ID 2026 USD",
                "_Year": 2026,
                "_Currency": "USD",
                "_Corp": 100,
                "_Account": "P90910",
                "_Cost_Center": 11900900,
                "_Reference_ID": "000000",
                "_Worktag_Type_ID": "Custom_Worktag_3_ID",
                "_Worktag_Value_ID": "R40",
                "_Labor_Group": "00000000000",
                "_Jan": 27.75,
                "_Feb": 27.75,
                "_Mar": 27.75,
                "_Apr": 27.75,
                "_May": 27.75,
                "_Jun": 27.75,
                "_Jul": 27.75,
                "_Aug": 27.75,
                "_Sep": 27.75,
                "_Oct": 27.75,
                "_Nov": 27.75,
                "_Dec": 27.75
            }
        ]

    res.map((item) => {
        let breakDown = breakdownItems.filter((items) => item._Account == items.VenaIdentifier && item._Cost_Center == items.CostCenter);

        if(breakDown[0] !== undefined){
            // some are undefined, as we purposefully skip items like fuel surcharge

            const BreakdownID = breakDown[0].ID;
            if(item._Account == 'P51005') {
                // ignore - not a cost
            }else if (item._Worktag_Value_ID.startsWith("D") || item._Worktag_Value_ID.startsWith("R")) {
                const EquipmentID = equipArray.indexOf(item._Worktag_Value_ID) + 1;
                buildQueryByMonth({ EquipmentID, BreakdownID, item });
            } else {
                // if vena does not stipulate an equiptype, but rather '0',
                // this means the cost is the same across all equipment types
                buildQueryByMonth({ EquipmentID: 1, BreakdownID, item });
                buildQueryByMonth({ EquipmentID: 2, BreakdownID, item });
                buildQueryByMonth({ EquipmentID: 3, BreakdownID, item });
                buildQueryByMonth({ EquipmentID: 4, BreakdownID, item });
                buildQueryByMonth({ EquipmentID: 5, BreakdownID, item });
            }
        }
    });


    const response = {
        statusCode: 200,
        body: returnQuery,
    };
    return response;
};